## 五、实例管理

### 相关知识点

比如内存怎么配、数据文件放在哪里

从初始化参数文件可以看到整个实例的参数情况：其中服务端参数文件是通过 alter语句来改

动态性能视图，是系统运行中的各种信息。是实例启动之后存在于内存中的

数据字典是写到磁盘里的，和实例的运作是没有关系的，实例关闭之后还存在，数据库没打开也是保存着的。保存数据库里的关键信息 / 元数据

一般是 dba_、all_、user_

管理员通过上面两个对系统进行优化

### sqlplus命令

1. 在sqlplus下调用sql脚本：@script.sql

2. 在sqlplus环境下查看当前用户：show user

3. 在sqlplus环境下切换到普通用户：conn scott/tiger

4. set命令设置SQL*Plus的运行环境

   - SQLPlus的运行环境是用来输入、执行SQLPluS命令和显示返回结果的场所

   - SET命令也称SET变量或维护系统变量，利用它可为SQL*Plus交互建立一个特殊的环境。
   - 语句：SET ｛system_variable｝ ｛system_value｝
   - 如，设置屏幕上每一行能够最多显示字符数、设置每页打印的行数、设置某个列的宽度等等等等

   - 通过SET命令设置的环境变量是临时的，不是永久的。当用户退出SQL*Ps环境后，用户设置的环境参数会全部丢失。

5. describe/desc：查询指定数据对象的组成结构


○ sqlplus的普通用户没有 “show parameter”的权限

○ 在SQLPlus环境中操作Oracle数据库，除了使用SQL语句外，用户接触比较多的就是SQLPlus命令，它们执行完成后，不会保存在SQL缓冲区中。

### 实例管理 —— 参数

启动实例时要查看初始化参数文件：分配多大的内存（实例启动的时候，要先分配内存）、用什么方式启动、各个文件在哪里、大小是多少…… 都是通过参数来指定。

参数文件有两种类型：服务器参数文件，文本参数文件。

#### 服务器参数文件

1. 形式是  f“spfile｛实例名｝.ora”

2. 是二进制文件，比较安全，不能用vim手动编辑，需要用专门的命令才可以改里面的参数。而且直接用vim来看，都是乱码的，不要随意改动【如果要改，就进入到sqlplus下，用alter命令改】

   <img src="5 实例管理.assets/image-20231228203240121.png" alt="image-20231228203240121" style="zoom: 67%;" />

3. 数据库启动的时候，会自动找这个 文件，默认是在  $ORACLE_HOME/dbs   下（ORACLE_HOME是在安装的时候指定的一个目录）

4. 因为不能直接打开来看，所以要通过以下方式查看服务端参数文件里面的参数【sys用户（管理员）才有权限看，普通用户报错 “表或视图不存在”】

   - select * from V$PARAMETER;
   - show parameter {x}（后面加了 x，则会把含有 x都列出来）

#### 文本参数文件

1. 可以用vim改
2. 在sqlplus里面输入 startup init.ora，就会以这个文件启动；（默认是用 服务器参数文件来启动，如果系统启动时未找到 spfile，则会自动搜索此文件）。
3. 早期是这个，后来有一个比较安全的、二进制的服务参数文件，保留文本参数文件是为了，当服务参数文件坏了、系统坏了的时候，而系统是自维护的，如果系统坏了，这些里面的数据就读不出来了（show 、select都是要系统启动之后才能读的  ），而文本文件可以手动编辑，所以我们就可以设置参数来让系统启动（启动的时候按照这个文本文件来启动），启动之后再进行分析、维护；而且服务参数文件只放在服务端，文本参数文件可以放在客户端。

#### 常见参数

1. DB_recovery_file_dest_size：默认2G，如果设置了归档模式，这里写着写着写满了，也会没办法启动系统；所以要么扩容，要么取消归档模式。
2. memory_target除了包含sga的大小，还包含外面pga的大小。

#### 更改参数

1. 两种级别的更改
   - 会话级别：比如张三连入，那么这个就是一个会话，所以相当于在用户级别上改
   - 系统级别：针对all用户
2. 两种类型的参数
   - 静态参数
     - 只能在参数文件中改
     - 改后要重启实例才生效
     - 约有110个参数
   - 动态参数
     - 可以在数据库联机时更改
     - 可以在会话 / 系统级别更改，分别用 alter session/system 命令
     - 有效性：会话期间有效，或取决于 scope的取值
     - 约有234个参数

### 实例管理 —— 数据字典

是数据库的元数据；含所有对象的名称和属性；创建或修改任何对象都会引起数据字典（视图）的更新，以反映这些更改。

数据字典是Oracle存放关于数据库内部信息的地方，其用途是用来描述数据库内部的运行和管理情沉。比如，一个数据表的所有者、创建时间、所属表空间、用户访问权限等信息，这些信息都可以在数据字典中查找到。当用户操作数据库遇到困难时，就可以通过查询数据字典来提供帮助信息。

由Oracle DB服务器使 用，可用于查找关于用户、对象、约束条件和存储的信息。

对象结构或定义修改时，Oracle DB将做出相应维护。

可供任意用户使用以查询关于数据库的信息，只是每个人可以看到的范围不一样。

名称：前缀 + 后缀，用 _ 连接

- dba_：包含数据库实例的所有对象信息。
  - 基本数据字典主要包括描述逻辑存储结构和物理存储结构的数据表，另外，还包括一些描述其他数据对象信息的表，比如dba_views、 dba_triggers、dba_users等
- v$_：当前实例的动态视图，包含系统管理和系统优化等所使用的视图。
  - 这些视图提供了关于内存和磁盘的运行情况，用户只能进行只读访问而不能修改它们。
- user_：记录用户的对象信息。
- gv_：分布式环境下所有实例的动态视图，包含系统管理和系统优化使用的视图。
- all_：记录用户的对象信息机被授权访问的对象信息。

不得使用SQL直接进行修改。
